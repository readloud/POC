#
# x86 page table constants.
#

def VA_SIGN_NEG(va):
	return ((va) | 0xffff000000000000)

def pl3_i(va):
	return (((va) & L3_FRAME) >> L3_SHIFT)

L1_SHIFT = 12
L2_SHIFT = 21
L3_SHIFT = 30
L4_SHIFT = 39

NBPD_L1 = (1 << L1_SHIFT)
NBPD_L2 = (1 << L2_SHIFT)
NBPD_L3 = (1 << L3_SHIFT)
NBPD_L4 = (1 << L4_SHIFT)

L4_SLOT_PTE = 256
PTE_BASE = VA_SIGN_NEG(L4_SLOT_PTE * NBPD_L4)
L1_BASE = PTE_BASE
L2_BASE = L1_BASE + L4_SLOT_PTE * NBPD_L3
L3_BASE = L2_BASE + L4_SLOT_PTE * NBPD_L2
L4_BASE = L3_BASE + L4_SLOT_PTE * NBPD_L1

L4_MASK = 0x0000ff8000000000
L3_MASK = 0x0000007fc0000000
L2_MASK = 0x000000003fe00000
L1_MASK = 0x00000000001ff000

L4_FRAME = L4_MASK
L3_FRAME = (L4_FRAME|L3_MASK)
L2_FRAME = (L3_FRAME|L2_MASK)
L1_FRAME = (L2_FRAME|L1_MASK)

L4_KERN = 511
KERN_L4_BASE = VA_SIGN_NEG(L4_KERN * NBPD_L4)
